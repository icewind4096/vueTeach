<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<script type="text/javascript" src="./common/vue.js"></script>

<link rel="stylesheet" href="./common/iconfont.css">

<style>
    :root{
        --pinHeight: 18px;
        --pinWidth: 78px;
        --pin2Edge: 25px;
        --pin2pinOffset: 10px;
        --func2funcOffset: 28px;
        --pinnumwidth: 16px;

        --bodyOffsetY: 300px;
        --bodyLogoFontName: 'Courier New', Courier, monospace;
        --bodyBoardWidth: 1px;
        --bodyBoardColor: black;

        --logoChipName2LeftEdge: 80px;
        --logoChipName2TopEdge: 238px;
        --logoChipNameFontSize: 32px;
        --logoChipNameFontName: Arial, Helvetica, sans-serif;

        --logoChipNameUnderLineWidth: 280px;
        --logoChipNameUnderLineHeight: 2px;
        --logoChipNameUnderLineColor: black;

        --logoChipManu2LeftEdge: 80px;
        --logoChipManu2TopEdge: 238px;
        --logoChipManuFontSize: 32px;
        --logoChipManuFontName: Arial, Helvetica, sans-serif;

        --pinLeftPad: 2px;
        --afdropdownleftpad: 20px;          /*用于给af功能的dropdown留出边距，要不af的list太长，会遮盖到一个af功能*/
        --afdropdownwidth: 120px;
    }

    *{
        padding: 0px;
        margin: 0px;
    }

    .chipbody{
            position: relative;
            font-family: var(--bodyLogoFontName);
            font-size: 12px;
            margin: var(--bodyOffsetY) auto;
            border: var(--bodyBoardWidth) solid var(--bodyBoardColor);
            height: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge));
            width: calc(var(--widthRate) * ((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge)));
            background: linear-gradient(to bottom right, black, grey, #909090 , #303030);
            /* background: linear-gradient(150deg,white, black); */
            /* transform: scale(1.5);              */
            /* transform:rotate(45deg); */
    }

    .chiplogonameH{
        position:absolute;
        left: var(--logoChipName2LeftEdge);
        top: var(--logoChipName2TopEdge);
        font-family: var(--logoChipNameFontName);
        font-size: var(--logoChipNameFontSize);
    }

    .chiplogonameunderlineH{
        position:absolute;
        background-color: var(--logoChipNameUnderLineColor);
        left: var(--logoChipName2LeftEdge);
        top: calc(var(--logoChipName2TopEdge) + var(--logoChipNameFontSize));
        height: var(--logoChipNameUnderLineHeight);
        width: var(--logoChipNameUnderLineWidth);
    }

    .chiplogomanufactureH{
        position: absolute;
        left: var(--logoChipManu2LeftEdge);
        top: calc(var(--logoChipName2TopEdge) + var(--logoChipNameFontSize) + var(--logoChipNameUnderLineHeight));
        font-family: var(--logoChipManuFontName);
        font-size: var(--logoChipManuFontSize);
        background: linear-gradient(215deg,blue, gold);
        -webkit-text-fill-color:transparent;
        -webkit-background-clip: text;
        background-clip: text;
    }

    .chiplogonameV{
        position:absolute;
        left: var(--logoChipName2LeftEdge);
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) - 2 * var(--logoChipNameFontSize));
        font-family: var(--logoChipNameFontName);
        font-size: var(--logoChipNameFontSize);
        transform: rotate(-90deg);
        transform-origin: left bottom;
    }

    .chiplogonameunderlineV{
        position:absolute;
        background-color: var(--logoChipNameUnderLineColor);
        left: calc(var(--logoChipName2LeftEdge));
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) - var(--logoChipNameFontSize) + 2 * var(--logoChipNameUnderLineHeight));
        height: var(--logoChipNameUnderLineHeight);
        width: var(--logoChipNameUnderLineWidth);
        transform: rotate(-90deg);
        transform-origin: left bottom;
    }

    .chiplogomanufactureV{
        position: absolute;
        left: var(--logoChipManu2LeftEdge);
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) - var(--logoChipNameFontSize) + 2 * var(--logoChipNameUnderLineHeight)  + 2 * var(--logoChipNameUnderLineHeight));
        font-family: var(--logoChipNameFontName);
        font-size: var(--logoChipNameFontSize);
        font-family: var(--logoChipManuFontName);
        font-size: var(--logoChipManuFontSize);
        background: linear-gradient(215deg,blue, gold);
        -webkit-text-fill-color:transparent;
        -webkit-background-clip: text;
        background-clip: text;
        transform: rotate(-90deg);
        transform-origin: left top;
    }

    .unvisiable{
        visibility: hidden;
     }

     .vddpin{
        background-color: red;
    }

    .vsspin{
        color: white !important;
        background-color: black;
    }

    .vddapin{
        background-color: rgba(255, 0, 0, 0.5)
    }

    .vssapin{
        background-color: rgba(0, 0, 0, 0.5)
    }

    .nrstpin{
        background-color:rgba(128, 128, 128, 0.5)
    }

    .bootpin{
        background-color: white
    }

    .gpioa{
        background-color:rgba(216, 92, 87, 0.4);
    }

    .gpiob{
        background-color:rgba(84, 56, 245, 0.4);
    }

    .gpioc{
        background-color:rgba(100, 17, 107, 0.4);
    }

    .gpiod{
        background-color:rgba(217, 243, 158, 0.4);
    }

    .gpioe{
        background-color:rgba(235, 41, 50, 0.4);
    }

    .gpiof{
        background-color:rgba(240, 83, 21, 0.4);
    }

    .gpiog{
        background-color:rgba(139, 163, 155, 0.4);
    }

    .gpioh{
        background-color:rgba(207, 21, 161, 0.4);
    }

    .roatte90{
        transform: rotate(90deg);
    }

    .nroatte90{
        transform: rotate(-90deg);
        transform-origin: 0 0;
    }

    .pinrect{
        position: absolute;
        height: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset));
        width: calc(var(--pinWidth) + 4 * var(--bodyBoardWidth));
    }

    .pinrectV{
        top: var(--pin2Edge);
    }

    .pinrectstyle{
        list-style: none;
     }

     .leftpinnumbrect{
         left: 0px;
         width: var(--pinnumwidth)
     }

     .rightpinnumbrect{
         /* left: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) - var(--pinnumwidth)); */
         left: calc((var(--widthRate) * ((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge))) - var(--pinnumwidth));
         width: var(--pinnumwidth);
     }

     .buttonpinnumbrect{
        left: var(--pin2Edge);
        width: var(--pinnumwidth);
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge));
     }

     .toppinnumbrect{
        left: var(--pin2Edge);
        top: var(--pinnumwidth);
        width: var(--pinnumwidth);
     }

     .leftpinnamerect{
        left: calc(0px - 4 * var(--bodyBoardWidth) - var(--pinWidth) + 2 *var(--bodyBoardWidth));
     }

     .rightnamerect{
        /* left: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge)); */
        left: calc(var(--widthRate) * ((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge)));
    }

    .buttonnamerect{
        left: var(--pin2Edge);
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) + var(--pinWidth) + 4 * var(--bodyBoardWidth));
    }

    .topnamerect{
        left: var(--pin2Edge);
        top: 0px;
    }

     .leftpinafrect{
        left: calc(0px - 4 * var(--bodyBoardWidth) - 2 * var(--pinWidth) - var(--func2funcOffset));
     }

     .rightpinafrect{
        /* left: calc((((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge)) + var(--pinWidth) + 4 * var(--bodyBoardWidth) + var(--func2funcOffset))); */
        left: calc((var(--widthRate) * ((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge))) + var(--pinWidth) + 4 * var(--bodyBoardWidth) + var(--func2funcOffset));
     }

     .buttonpinafrect{
        left: var(--pin2Edge);
        top: calc((var(--pinCount) / var(--sideCount)) * (var(--pinHeight) + var(--pin2pinOffset) + var(--bodyBoardWidth) * 2) - var(--pin2pinOffset) + 2 * var(--pin2Edge) + var(--pinWidth) + 4 * var(--bodyBoardWidth) + 1px + var(--pinWidth) + var(--func2funcOffset));
     }

     .toppinafrect{
        left: var(--pin2Edge);
        top: calc(0px - (var(--pin2Edge) + var(--pinWidth) + var(--func2funcOffset)));
     }

     .pincell{
        border: 1px solid black;
        color: black;
     }

     .pinnumcell{
        height: var(--pinHeight);
        line-height: var(--pinHeight);
        margin-bottom: var(--pin2pinOffset);
        border: 1px solid rgba(0, 0, 0, 0);     /*不想重新计算位置，还是画边框，但是边框全透明*/
        color: white;
     }

     .pinname{
        width: var(--pinWidth);
        height: var(--pinHeight);
        line-height: var(--pinHeight);
        margin-bottom: var(--pin2pinOffset);
    }

    .pinaf{
        width: var(--pinWidth);
        height: var(--pinHeight);
        line-height: var(--pinHeight);
        margin-bottom: var(--pin2pinOffset);
        color: white;
        background-color: indianred;
    }

    .pinrightcell{
        padding-right: var(--pinLeftPad);
        text-align: right;
    }

    .pinrightcell:hover{
        box-shadow: 2px 3px #909090;
        color: white;
        background-color: rgba(32, 64, 128, 0.5);
    }

    .pinleftcell{
        padding-left: var(--pinLeftPad);
        text-align: left;
    }

    .pinleftcell:hover{
        box-shadow: 2px 3px #909090;
        color: white;
        background-color: rgba(32, 64, 128, 0.5);
    }

    .pincentercell{
        text-align: center;
    }

    .pincentercell:hover{
        box-shadow: 2px 3px #909090;
        color: white;
        background-color: rgba(32, 64, 128, 0.5);
    }

    .pinafdropdownlistV{
        display: none;
        position: absolute;
        z-index: 9999;
        left: var(--afdropdownleftpad);
        width: calc(var(--afdropdownwidth) + 2 * var(--bodyBoardWidth));
        border: 1px solid black;
    }

    .pinaf:hover{
        color: white;
        background-color:indigo;
    }

    .pinaf:hover .pinafdropdownlistV{
        display: block;
        color: white;
        background-color:darkorange;
    }

    .pinafname{
        height: var(--pinHeight);
    }

    .pinafnameemptycolor{
        background-color: gray;
    }

    .pinafnamenoemptycolor{
        background-color: goldenrod;
    }

    .pinafdropdownitem:hover{
        cursor: default;
        color: white;
        border-right: 1px solid grey;
        border-bottom: 1px solid grey;
        background-color:black;
    }

    .pinafdropdownlistH{
        display: none;
        position: absolute;
        z-index: 9999;
        left: 0px; /*var(--afdropdownleftpad);*/
        width: calc(var(--afdropdownwidth) + 2 * var(--bodyBoardWidth));
        border: 1px solid black;
        transform: rotate(90deg);
        transform-origin: calc(var(--pinHeight) / 2) calc(0px - var(--pinHeight) / 2);
    }

    .pinaf:hover .pinafdropdownlistH{
        display: block;
        color: white;
        background-color:darkorange;
    }

    .pinafdropdownitem:hover{
        cursor: default;
        color: white;
        border-right: 1px solid grey;
        border-bottom: 1px solid grey;
        background-color:black;
    }
</style>

<body>
    <div id="root">
        <!-- 外观配置 -->
        <div style="position: fixed; top:50px; right:50px;">
        </div>

        <!--  芯片主体 -->
        <div class="chipbody" :style="chiplookstyle">
            <!-- logo -->
            <div v-if="displaychiplogoname" :class="chiplogonamestyle">{{chiplogname}}</div>
            <div v-if="displaychiplogounderline" :class="chiplogounderlinestyle"></div>
            <div v-if="displaychiplogomanufacture" :class="chiplogomanufacturestyle">{{chiplogomanufacture}}</div>

            <!-- 左边pin脚 -->
            <div class="pinrect pinrectV leftpinnumbrect">
                <ul class="pinrectstyle">
                    <li class="pinleftcell pinnumcell" v-for="(item,index) in leftpins" :key="index">{{item.id}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV leftpinnamerect">
                <ul class="pinrectstyle">
                    <li class="pincell pinname pincentercell" :class="pintypeclass4name(item)" v-for="(item,index) in leftpins" :key="index">{{item.name}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV leftpinafrect">
                <ul class="pinrectstyle">
                    <li class="pincell pinaf pinleftcell" :class="pintypeclass4af(item)" v-for="(item,index) in leftpins" :key="index">
                        <div class="pinafname">
                            <span>{{afname(item)}}</span>
                        </div>
                        <ul class="pinrectstyle pinafdropdownlistV">
                            <li class="pinafdropdownitem" v-for="(afitem,index1) in item.AFs" @click="afdropdownclick(item.id, afitem)">{{'AF' + afitem.idx + '[' + afitem.name + ']'}}</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <!-- 底部pin脚 -->
            <div class="pinrect pinrectV nroatte90 buttonpinnumbrect ">
                <ul class="pinrectstyle">
                    <li class="pinrightcell pinnumcell" v-for="(item,index) in bottompins" :key="index">{{item.id}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV nroatte90 buttonnamerect">
                <ul class="pinrectstyle">
                    <li class="pincell pinname pincentercell" :class="pintypeclass4name(item)" v-for="(item,index) in bottompins" :key="index">{{item.name}}&nbsp;</li>
                </ul>
            </div>

            <div class="pinrect pinrectV nroatte90 buttonpinafrect">
                <ul class="pinrectstyle">
                    <li class="pincell pinaf pinleftcell" :class="pintypeclass4af(item)" v-for="(item,index) in bottompins" :key="index">
                        <div class="pinafname">
                            <span>{{afname(item)}}</span>
                        </div>
                        <ul class="pinrectstyle pinafdropdownlistH">
                            <li class="pinafdropdownitem" v-for="(afitem,index1) in item.AFs" @click="afdropdownclick(item.id, afitem)">{{afitem.name}}</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <!-- 右边pin脚 -->
            <div class="pinrect pinrectV rightpinnumbrect">
                <ul class="pinrectstyle">
                    <li class="pinrightcell pinnumcell" v-for="(item,index) in rightpins" :key="index">{{item.id}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV rightnamerect">
                <ul class="pinrectstyle">
                    <li class="pincell pinname pincentercell" :class="pintypeclass4name(item)" v-for="(item,index) in rightpins" :key="index">{{item.name}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV rightpinafrect">
                <ul class="pinrectstyle">
                    <li class="pincell pinaf pinrightcell" :class="pintypeclass4af(item)" v-for="(item,index) in rightpins" :key="index">
                        <div class="pinafname">
                            <span>{{afname(item)}}</span>
                        </div>
                        <ul class="pinrectstyle pinafdropdownlistV">
                            <li class="pinafdropdownitem pinleftcell" v-for="(afitem,index1) in item.AFs" @click="afdropdownclick(item.id, afitem)">{{afitem.name}}</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <!-- 上部pin脚 -->
            <div class="pinrect pinrectV nroatte90 toppinnumbrect ">
                <ul class="pinrectstyle">
                    <li class="pinrightcell pinnumcell" v-for="(item,index) in toppins" :key="index">{{item.id}}</li>
                </ul>
            </div>

            <div class="pinrect pinrectV nroatte90 topnamerect">
                <ul class="pinrectstyle">
                    <li class="pincell pinname pincentercell" :class="pintypeclass4name(item)" v-for="(item,index) in toppins" :key="index">{{item.name}}&nbsp;</li>
                </ul>
            </div>

            <div class="pinrect pinrectV nroatte90 toppinafrect">
                <ul class="pinrectstyle">
                    <li class="pincell pinaf pinrightcell" :class="pintypeclass4af(item)" v-for="(item,index) in toppins" :key="index">
                        <div class="pinafname">
                            <span>{{afname(item)}}</span>
                        </div>
                        <ul class="pinrectstyle pinafdropdownlistH">
                            <li class="pinafdropdownitem pinleftcell" v-for="(afitem,index1) in item.AFs" @click="afdropdownclick(item.id, afitem)">{{'AF' + afitem.idx + '[' + afitem.name + ']'}}</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
    const vm = new Vue({
        el: "#root",
        data:{
            rotateedge: 0,
            showchip: false,
            chiplookstyle:{
                transform: '',
            },
            storagekeynames:{
                afselectedkey: 'afselected',
            },
            chipinfo:{
                view:{
                    logo:{
                        name: true,
                        underline: true,
                        manufacture: true,
                    },
                    widthrate: 1, //widthrate: 0.618,
                },
                config:{
                    keys:{
                        storageafs: 'afs'
                    }
                },
                data:{
                    name: 'MM32F0131C7P',
                    manufacture: 'MindMotion',
                    package: 1, //type: 0-reserve 1-lqfp 2-tssop 3 qfn 4 bga
                    pinassign:[ //aligment: 0-left 1-right
                        {count: 16,  aligment: 0},
                        {count: 16,  aligment: 0},
                        {count: 16,  aligment: 0},
                        {count: 16,  aligment: 0},
                    ],
                    afs:[],
                    pins:[ //type: 1-gpio 2-vdd 3-vss 4-vdda 5-vdds 6-nRst, 7-boot
                         {id: 1,  name:'PD7', type: 1, AFs:[{idx: 5, name:"TIM3_CH1"},{idx: 6, name:"TIM17_CH1"}]}
                        ,{id: 2,  name:'PC13',type: 1, AFs:[{idx: 6, name:"TIM2_CHR"}]}
                        ,{id: 3,  name:'PC14',type: 1, AFs:[{idx: 6, name:"TIM2_CH2"}]}
                        ,{id: 4,  name:'PC15',type: 1, AFs:[{idx: 6, name:"TIM2_CH3"}]}
                        ,{id: 5,  name:'PD0', type: 1, AFs:[{idx: 1, name:"I2C1_SDA"},{idx: 2, name:"TIM1_CH1N"},{idx: 3, name:"UART1_TX"},{idx: 4, name:"TIM1_CH2"},{idx: 5, name:"SPI1_MOSI"}]}
                        ,{id: 6,  name:'PD1', type: 1, AFs:[{idx: 1, name:"TIM1_BKIN"},{idx: 2, name:"I2C1_SCL"},{idx: 3, name:"TIM1_CH1"},{idx: 4, name:"UART1_RX"},{idx: 5, name:"TIM1_CH2"},{idx: 6, name:"SPI1_MISO"},{idx: 5, name:"SPI1_SCK"}]}
                        ,{id: 7,  name:'nRST',type: 6}
                        ,{id: 8,  name:'PC0', type: 1}
                        ,{id: 9,  name:'PC1', type: 1}
                        ,{id: 10, name:'PC2', type: 1, AFs:[{idx: 1, name:"SPI2_MISO"}]}
                        ,{id: 11, name:'PC3', type: 1, AFs:[{idx: 1, name:"SPI2_MOSI"}]}
                        ,{id: 12, name:'VSSA',type: 4}
                        ,{id: 13, name:'VDDA',type: 5}
                        ,{id: 14, name:'PA0', type: 1, AFs:[{idx: 1, name:"UART2_CTS"},{idx: 2, name:"TIM2_CH1"},{idx: 4, name:"UART1_RX"},{idx: 6, name:"TIM14_CH1"},{idx: 7, name:"COMP1_OUT"}]}
                        ,{id: 15, name:'PA1', type: 1, AFs:[{idx: 1, name:"UART2_RTS"},{idx: 2, name:"TIM2_CH2"},{idx: 3, name:"TIM1_CH2"},{idx: 4, name:"UART1_TX"}]}
                        ,{id: 16, name:'PA2', type: 1, AFs:[{idx: 1, name:"UART2_TX"},{idx: 2, name:"TIM2_CH3"},{idx: 3, name:"TIM1_CH2N"},{idx: 7, name:"COMP2_OUT"}]}
                        ,{id: 17, name:'PA3', type: 1, AFs:[{idx: 1, name:"UART2_RX"},{idx: 2, name:"TIM2_CH4"},{idx: 3, name:"TIM1_CH3"}]}
                        ,{id: 18, name:'PD4', type: 1, AFs:[{idx: 0, name:"SPI1_MISO"},{idx: 1, name:"SPI2_MOSI"}]}
                        ,{id: 19, name:'PD5', type: 1, AFs:[{idx: 0, name:"SPI1_MOSI"},{idx: 1, name:"SPI2_MISO"}]}
                        ,{id: 20, name:'PA4', type: 1, AFs:[{idx: 0, name:"SPI1_NSS"},{idx: 1, name:"SPI1_SCK"},{idx: 3, name:"TIM1_CH3N"},{idx: 4, name:"TIM14_CH1"},{idx: 5, name:"TIM1_BNIN"}]}
                        ,{id: 21, name:'PA5', type: 1, AFs:[{idx: 0, name:"SPI1_SCK"},{idx: 1, name:"SPI1_NSS"},{idx: 2, name:"TIM2_CH1"},{idx: 6, name:"TIM3_CH3N"}]}
                        ,{id: 22, name:'PA6', type: 1, AFs:[{idx: 0, name:"SPI1_MISO"},{idx: 1, name:"TIM3_CH1"},{idx: 2, name:"TIM1_BKIN"},{idx: 5, name:"TIM16_CH1"},{idx: 6, name:"TIM1_CH3"},{idx: 7, name:"COMP1_OUT"}]}
                        ,{id: 23, name:'PA7', type: 1, AFs:[{idx: 0, name:"SPI1_MOSI"},{idx: 1, name:"TIM3_CH2"},{idx: 2, name:"TIM1_CH1N"},{idx: 3, name:"TIM1_CH3N"},{idx: 4, name:"TIM14_CH1"},{idx: 5, name:"TIM17_CH1"},{idx: 6, name:"TIM1_CH2N"},{idx: 7, name:"COMP2_OUT"}]}
                        ,{id: 24, name:'PC4', type: 1, AFs:[{idx: 3, name:"UART2_TX"},{idx: 5, name:"TIM3_CH1"},{idx: 6, name:"SPI1_MOSI"}]}
                        ,{id: 25, name:'PC5', type: 1, AFs:[{idx: 3, name:"UART2_RX"},{idx: 5, name:"TIM3_CH2"},{idx: 6, name:"SPI1_MISO"}]}
                        ,{id: 26, name:'PB0', type: 1, AFs:[{idx: 1, name:"TIM3_CH3"},{idx: 2, name:"TIM1_CH2N"},{idx: 3, name:"TIM1_CH1N"},{idx: 4, name:"TIM1_CH3"}]}
                        ,{id: 27, name:'PB1', type: 1, AFs:[{idx: 0, name:"TIM14_CH1"},{idx: 1, name:"TIM3_CH4"},{idx: 2, name:"TIM1_CH3N"},{idx: 3, name:"TIM1_CH2N"},{idx: 4, name:"TIM2_CH3"},{idx: 5, name:"TIM1_CH2"},{idx: 6, name:"TIM1_CH1N"}]}
                        ,{id: 28, name:'PB2', type: 1}
                        ,{id: 29, name:'PB10',type: 1, AFs:[{idx: 1, name:"I2C1_SCL"},{idx: 2, name:"TIM2_CH3"},{idx: 5, name:"SPI2_SCK"}]}
                        ,{id: 30, name:'PB11',type: 1, AFs:[{idx: 1, name:"I2C1_SDA"},{idx: 2, name:"TIM2_CH4"}]}
                        ,{id: 31, name:'VSS', type: 3}
                        ,{id: 32, name:'VDD', type: 2}
                        ,{id: 33, name:'PB12',type: 1, AFs:[{idx: 0, name:"SPI2_NSS"},{idx: 1, name:"SPI2_SCK"},{idx: 2, name:"TIM1_BKIN"},{idx: 3, name:"SPI2_MOSI"},{idx: 4, name:"SPI2_MISO"}]}
                        ,{id: 34, name:'PB13',type: 1, AFs:[{idx: 0, name:"SPI2_SCK"},{idx: 1, name:"SPI2_MISO"},{idx: 2, name:"TIM1_CH1N"},{idx: 3, name:"SPI2_NSS"},{idx: 4, name:"SPI2_MOSI"},{idx: 5, name:"I2C1_SCL"},{idx: 6, name:"TIM17_CH1"},{idx: 7, name:"TIM1_CH3N"}]}
                        ,{id: 35, name:'PB14',type: 1, AFs:[{idx: 0, name:"SPI2_MISO"},{idx: 1, name:"SPI2_MOSI"},{idx: 2, name:"TIM1_CH2N"},{idx: 3, name:"SPI2_SCK"},{idx: 4, name:"SPI2_NSS"},{idx: 5, name:"I2C1_SDA"},{idx: 6, name:"TIM1_CH3"},{idx: 7, name:"TIM1_CH1"}]}
                        ,{id: 36, name:'PB15',type: 1, AFs:[{idx: 0, name:"SPI2_MOSI"},{idx: 1, name:"SPI2_NSS"},{idx: 2, name:"TIM1_CH3N"},{idx: 3, name:"SPI2_MISO"},{idx: 4, name:"SPI2_SCK"},{idx: 6, name:"TIM1_CH2N"},{idx: 7, name:"TIM1_CH2"}]}
                        ,{id: 37, name:'PC6', type: 1, AFs:[{idx: 1, name:"TIM3_CH1"},{idx: 6, name:"TIM3_CH3"},{idx: 7, name:"SPI1_NSS"}]}
                        ,{id: 38, name:'PC7', type: 1, AFs:[{idx: 1, name:"TIM3_CH2"},{idx: 6, name:"TIM2_CH1"},{idx: 7, name:"SPI1_SCK"}]}
                        ,{id: 39, name:'PC8', type: 1, AFs:[{idx: 1, name:"TIM3_CH3"},{idx: 6, name:"TIM2_CH2"}]}
                        ,{id: 40, name:'PC9', type: 1, AFs:[{idx: 1, name:"TIM3_CH4"},{idx: 6, name:"TIM2_CH3"}]}
                        ,{id: 41, name:'PA8', type: 1, AFs:[{idx: 0, name:"MCO"},{idx: 2, name:"TIM1_CH1"},{idx: 6, name:"TIM1_CH2"},{idx: 7, name:"TIM1_CH3"}]}
                        ,{id: 42, name:'PA9', type: 1, AFs:[{idx: 1, name:"UART1_TX"},{idx: 2, name:"TIM1_CH2"},{idx: 3, name:"UART1_RX"},{idx: 4, name:"I2C1_SCL"},{idx: 5, name:"MCO"},{idx: 6, name:"TIM1_CH1N"}]}
                        ,{id: 43, name:'PA10',type: 1, AFs:[{idx: 0, name:"TIM17_BKIN"},{idx: 1, name:"UART1_RX"},{idx: 2, name:"TIM1_CH3"},{idx: 3, name:"UART1_TX"},{idx: 4, name:"I2C1_SDA"},{idx: 5, name:"TIM1_CH1"},{idx: 6, name:"TIM16_CH1"}]}
                        ,{id: 44, name:'PA11',type: 1, AFs:[{idx: 1, name:"UART1_CTS"},{idx: 2, name:"TIM1_CH4"},{idx: 3, name:"TIM1_CH3"},{idx: 4, name:"CAN1_RX"},{idx: 5, name:"I2C1_SCL"},{idx: 6, name:"TIM1_BKIN"},{idx: 6, name:"COMP1_OUT"}]}
                        ,{id: 45, name:'PA12',type: 1, AFs:[{idx: 1, name:"UART1_RTS"},{idx: 2, name:"TIM1_ETR"},{idx: 3, name:"TIM1_CH3N"},{idx: 4, name:"CAN1_TX"},{idx: 5, name:"I2C1_SDA"},{idx: 6, name:"TIM1_CH2"},{idx: 6, name:"COMP2_OUT"}]}
                        ,{id: 46, name:'PA13',type: 1, AFs:[{idx: 0, name:"SWDIO"},{idx: 3, name:"UART1_TX"}]}
                        ,{id: 47, name:'PD2', type: 1, AFs:[{idx: 1, name:"I2C1_SCL"},{idx: 5, name:"SPI1_NSS"},{idx: 6, name:"SPI1_NSS"}]}
                        ,{id: 48, name:'PD3', type: 1, AFs:[{idx: 1, name:"I2C1_SDA"},{idx: 5, name:"SPI1_SCK"},{idx: 6, name:"SPI1_NSS"}]}
                        ,{id: 49, name:'PA14',type: 1, AFs:[{idx: 0, name:"SWDCLK"},{idx: 1, name:"UART2_TX"},{idx: 3, name:"UART1_RX"}]}
                        ,{id: 50, name:'PA15',type: 1, AFs:[{idx: 0, name:"SPI1_NSS"},{idx: 1, name:"UART2_RX"},{idx: 2, name:"TIM2_CH1"},{idx: 3, name:"SPI2_SCK"},{idx: 4, name:"SPI2_MOSI"},{idx: 5, name:"SPI2_MISO"},{idx: 6, name:"TIM1_CH1N"},{idx: 7, name:"TIM1_CH3N"}]}
                        ,{id: 51, name:'PC10',type: 1, AFs:[{idx: 0, name:"UART1_TX"},{idx: 3, name:"SPI2_MISO"},{idx: 4, name:"SPI2_SCK"},{idx: 5, name:"SPI2_NSS"},{idx: 6, name:"SPI2_MOSI"},{idx: 7, name:"COMP2_OUT"}]}
                        ,{id: 52, name:'PC11',type: 1, AFs:[{idx: 0, name:"UART1_RX"},{idx: 3, name:"SPI2_MOSI"},{idx: 4, name:"SPI2_NSS"},{idx: 5, name:"SPI2_SCK"},{idx: 6, name:"SPI2_MISO"}]}
                        ,{id: 53, name:'PC12',type: 1, AFs:[{idx: 0, name:"UART1_TX"},{idx: 3, name:"SPI2_SCK"},{idx: 4, name:"SPI2_MISO"},{idx: 5, name:"SPI2_MOSI"},{idx: 6, name:"SPI2_NSS"}]}
                        ,{id: 54, name:'PD6', type: 1, AFs:[{idx: 1, name:"TIM3_ETR"},{idx: 3, name:"TIM1_CH3N"},{idx: 5, name:"TIM1_CH1"},{idx: 6, name:"TIM1_CH1N"}]}
                        ,{id: 55, name:'PB3', type: 1, AFs:[{idx: 0, name:"SPI1_SCK"},{idx: 2, name:"TIM2_CH2"},{idx: 4, name:"TIM1_CH1"},{idx: 6, name:"TIM1_CH2N"},{idx: 7, name:"TIM1_CH3"}]}
                        ,{id: 56, name:'PB4', type: 1, AFs:[{idx: 0, name:"SPI1_MISO"},{idx: 1, name:"TIM3_CH1"},{idx: 4, name:"TIM1_CH2"},{idx: 5, name:"TIM17_BKIN"},{idx: 6, name:"TIM1_CH3N"},{idx: 7, name:"TIM1_CH2N"}]}
                        ,{id: 57, name:'PB5', type: 1, AFs:[{idx: 0, name:"SPI1_MOSI"},{idx: 1, name:"TIM3_CH2"},{idx: 2, name:"TIM16_BKIN"},{idx: 6, name:"TIM1_CH1"},{idx: 7, name:"TIM1_CH2"}]}
                        ,{id: 58, name:'PB6', type: 1, AFs:[{idx: 0, name:"UART1_TX"},{idx: 1, name:"I2C1_SCL"},{idx: 2, name:"TIM16_CH1N"},{idx: 4, name:"TIM1_CH2N"},{idx: 6, name:"TIM1_CH2"},{idx: 7, name:"TIM1_CH1N"}]}
                        ,{id: 59, name:'PB7', type: 1, AFs:[{idx: 0, name:"UART1_RX"},{idx: 1, name:"I2C1_SDA"},{idx: 2, name:"TIM17_CH1N"},{idx: 6, name:"TIM1_CH3"},{idx: 7, name:"TIM1_CH1"}]}
                        ,{id: 60, name:'BOOT0',type: 7}
                        ,{id: 61, name:'PB8', type: 1, AFs:[{idx: 0, name:"UART1_RX"},{idx: 1, name:"I2C1_SCL"},{idx: 2, name:"TIM16_CH1"},{idx: 3, name:"TIM1_CH1"},{idx: 4, name:"CAN1_RX"},{idx: 6, name:"TIM3_CH2"}]}
                        ,{id: 62, name:'PB9', type: 1, AFs:[{idx: 0, name:"UART1_TX"},{idx: 1, name:"I2C1_SDA"},{idx: 2, name:"TIM17_CH1"},{idx: 4, name:"CAN1_TX"},{idx: 5, name:"SPI2_NSS"},{idx: 6, name:"TIM3_CH3"}]}
                        ,{id: 63, name:'VSS', type: 3}
                        ,{id: 64, name:'VDD', type: 2}
                    ],
                    class4pintype: ['', 'gpio','vddpin','vsspin','vddapin','vssapin','nrstpin', 'bootpin'],
                }
            },
        },
        created() {
            window.onbeforeunload = () => {
                this.savedata();
            }

            document.body.style.setProperty('--pinCount', this.visualpincount);
            document.body.style.setProperty('--sideCount', this.sidecount);
            document.body.style.setProperty('--widthRate', this.widthrate);

            this.loaddata();
        },
        mounted() {
        },
        beforeDestroy(){
            this.savedata();
        },
        destroyed () {
        },
        computed: {
            chipname:{
                get(){
                    return this.chipinfo.data.name;
                }
            },
            chipmanufacture:{
                get(){
                    return this.chipinfo.data.manufacture;
                }
            },
            chippackage:{
                get(){
                    return this.chipinfo.data.package;
                }
            },
            chiplogname:{
                get(){
                    return this.chipname;
                }
            },
            chiplogonamestyle:{
                get(){
                    if (this.chippackage === 2){
                        return 'chiplogonameV'
                    }
                    return 'chiplogonameH'
                }
            },
            displaychiplogoname:{
                get(){
                    return this.chipinfo.view.logo.name === true;
                }
            },
            displaychiplogounderline:{
                get(){
                    return this.chipinfo.view.logo.underline === true;
                }
            },
            chiplogounderlinestyle:{
                get(){
                    if (this.chippackage === 2){
                        return 'chiplogonameunderlineV'
                    }
                    return 'chiplogonameunderlineH'
                }
            },
            chiplogomanufacture:{
                get(){
                    return this.chipmanufacture;
                }
            },
            chiplogomanufacturestyle:{
                get(){
                    if (this.chippackage === 2){
                        return 'chiplogomanufactureV'
                    }
                    return 'chiplogomanufactureH'
                }
            },
            displaychiplogomanufacture:{
                get(){
                    return this.chipinfo.view.logo.manufacture === true;
                }
            },
            visualpincount:{
                get(){
                    return this.maxsidepincount * this.sidecount;
                }
            },
            pincount:{
                get(){
                    var count = 0;
                    for (var i = 0; i < this.chipinfo.data.pinassign.length; i++){
                        count = count + this.chipinfo.data.pinassign[i].count;
                    }
                    return count;
                }
            },
            sidecount:{
                get(){
                    return this.chippackage != 2 ? 4 : 2;
                }
            },
            maxsidepincount:{
                get(){
                    var count = 0;
                    for (var i = 0; i < this.sidecount; i++){
                        count = this.chipinfo.data.pinassign[i].count > count ? this.chipinfo.data.pinassign[i].count : count;
                    }
                    return count;
                }
            },
            widthrate:{
                get(){
                    return this.chipinfo.view.widthrate;
                }
            },
            pins:{
                get(){
                    return this.chipinfo.data.pins.slice(0, this.pincount);
                }
            },
            leftpinendidx:{
                get(){
                    return this.chipinfo.data.pinassign[0].count;
                }
            },
            leftpinaligment:{
                get(){
                    return this.chipinfo.data.pinassign[0].aligment;
                }
            },
            leftpins:{
                get(){
                    let pininfos = this.adjustpininfosH(this.pins.slice(0, this.leftpinendidx)
                                                      ,this.maxsidepincount
                                                      ,this.leftpinaligment);
                    return pininfos;
                }
            },
            buttompinendidx:{
                get(){
                    return this.chipinfo.data.pinassign[0].count + this.chipinfo.data.pinassign[1].count;
                }
            },
            bottompinaligment:{
                get(){
                    return this.chipinfo.data.pinassign[1].aligment;
                }
            },
            bottompins:{
                get(){
                    let pininfos = this.adjustpininfosH(this.pins.slice(this.leftpinendidx, this.buttompinendidx)
                                                      ,this.maxsidepincount
                                                      ,this.bottompinaligment);
                    return pininfos;
                }
            },
            rightpinendidx:{
                get(){
                    return this.chipinfo.data.pinassign[0].count + this.chipinfo.data.pinassign[1].count + this.chipinfo.data.pinassign[2].count;
                }
            },
            rightpinaligment:{
                get(){
                    return this.chipinfo.data.pinassign[2].aligment;
                }
            },
            rightpins:{
                get(){
                    let pininfos = this.adjustpininfosV(this.pins.slice(this.buttompinendidx, this.rightpinendidx)
                                                        ,this.maxsidepincount
                                                        ,this.rightpinaligment);
                    return pininfos;
                }
            },
            toppinendidx:{
                get(){
                    return this.chipinfo.data.pinassign[0].count + this.chipinfo.data.pinassign[1].count + this.chipinfo.data.pinassign[2].count +  + this.chipinfo.data.pinassign[3].count;
                }
            },
            toppinaligment:{
                get(){
                    return this.chipinfo.data.pinassign[3].aligment;
                }
            },
            toppins:{
                get(){
                    let pininfos = this.adjustpininfosV(this.pins.slice(this.rightpinendidx, this.toppinendidx)
                                                        ,this.maxsidepincount
                                                        ,this.toppinaligment);
                    return pininfos;
                }
            },
            afname:{
                get(){
                    return function(item){
                        if (item.name != undefined){
                            return this.chipinfo.data.afs[item.id - 1].name;
                        }
                        return '';
                    }
                }
            }
        },
        watch:{
            'pincount':{
                immediate: true,
                handler(newvalue, oldvalue){
                    this.chipinfo.data.afs.length = 0;
                    for (var i = 0; i < newvalue; i ++){
                        this.chipinfo.data.afs.push({name: '' })
                    }
                }
            }
        },
        methods: {
            adjustpininfos(pinarray, sidecount, aligment){
                var arr = pinarray;
                for (let i = arr.length; i < sidecount; i ++){
                    if (aligment === 0){
                        arr.push({});
                    }
                    else {
                        arr.unshift({});
                    }
                }
                return arr;
            },
            adjustpininfosH(pinarray, sidecount, aligment){
                return this.adjustpininfos(pinarray, sidecount, aligment)
            },
            adjustpininfosV(pinarray, sidecount, aligment){
                //转90度实现的，所以数据/显示左右对齐方式 都要颠倒
                return this.adjustpininfos(pinarray.reverse(), sidecount, aligment == 1 ? 0 : 1)
            },
            pintypeclass4name(item){
                if (item.id === undefined){
                    return 'unvisiable';
                }

                if (item.type === 1){
                    return this.chipinfo.data.class4pintype[item.type] + item.name.substring(1, 2).toLowerCase();
                }
                return this.chipinfo.data.class4pintype[item.type];
            },
            pintypeclass4af(item){
                if ((item.type != 1) || (item.type === 1 && item.AFs === undefined)){
                    return 'unvisiable';
                }

                if (this.afname(item).length === 0){
                    return 'pinafnameemptycolor'
                }
                return 'pinafnamenoemptycolor'
            },
            afdropdownclick(id, item){
                this.chipinfo.data.afs[id - 1].name = item.name;
            },
            loaddata(){
                const afs = JSON.parse(localStorage.getItem(this.chipinfo.config.keys.storageafs));
                if (afs != undefined && afs.length > 0){
                    for (let i = 0; i < afs.length; i++){
                        this.chipinfo.data.afs[afs[i].id].name = afs[0].name;
                    }
                }
            },
            savedata(){
                let afs = []
                for (var i = 0; i < this.chipinfo.data.afs.length; i ++){
                    if ((this.chipinfo.data.afs[i].name != undefined) && (this.chipinfo.data.afs[i].name.length > 0)){
                        afs.push({id: i, name: this.chipinfo.data.afs[i].name})
                    }
                }
                localStorage.setItem(this.chipinfo.config.keys.storageafs, JSON.stringify(afs));
            }
        }
    })
</script>

</html>
